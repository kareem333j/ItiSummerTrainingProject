{% extends 'layout/base.html' %}
{% load static %}

{% block title %} Book Info {% endblock title %}
{% block style %}
    <style>
        .book-info{
            border-spacing: 3px 0.3em;
        }
        .finish{
            cursor: no-drop !important;
        }
    </style>
{% endblock style %}
{% block content %}
<div class="w-100 pt-5" style="min-height: 90vh;">
    {% for msg in messages %}
    <div class="w-100">
        <div class="alert alert-success alert02" role="alert">
            {{msg}}
        </div>
    </div>
    <script>
        const alert02 = document.querySelector('.alert02');
        setTimeout(()=>{
            alert02.remove();
        }, 5000);
    </script>
    {% endfor %}
    <div class="row d-flex justify-content-center align-items-center mb-5">
        <h3 class="text-start text-light fw-bold col-lg-12" style="font-size: 2.2em;"><i class="fa-solid fa-angle-right" style="font-size: 0.9em;color:#807696"></i> ``{{book.title}}``  details : </h3>
    </div>
    <div class="row">
        <div class="image col-lg-6 px-3 py-1">
            <img class="img-fluid" src="{{book.image_url}}" alt="book-image">
        </div>
        <div class="image col-lg-6 mb-5 flex-column">
            <table class="table1 w-100 book-info">
                <tr>
                    <th>ID</th>
                    <td>{{book.id}}</td>
                </tr>
                <tr>
                    <th>Title</th>
                    <td>{{book.title}}</td>
                </tr>
                <tr>
                    <th>Author</th>
                    <td>{{book.author}}</td>
                </tr>
                <tr>
                    <th>Description</th>
                    <td>{{book.description}}</td>
                </tr>
                <tr>
                    <th>Category</th>
                    <td>{{book.category}}</td>
                </tr>
                <tr>
                    <th>Stock</th>
                    <td>x{{book.stock}}</td>
                </tr>
            </table>
            <div class="d-flex gap-1 w-100">
                {% if book.borrowed == True %}
                <button style="border-radius: 0;" data-book="{{book.id}}" id="return-btn" class="btn btn-outline-info return-btn w-100 m-1">return</button>
                {% else %}
                    {% if book.stock > 0 %}
                    <button style="border-radius: 0;" data-book="{{book.id}}" id="borrow-btn" class="btn btn-outline-info borrow-btn w-100 m-1">borrow</button>
                    {% else %}
                    <button style="border-radius: 0;" style="cursor:no-drop" class="btn btn-secondary finish w-100 m-1">finished</button>
                    {% endif %}
                {% endif %}
            </div>
        </div>
    </div>
    <div class="row d-flex justify-content-center align-items-center mt-5 mb-4">
        <h3 class="text-start text-light fw-bold col-lg-12" style="font-size: 2.2em;"><i class="fa-solid fa-angle-right" style="font-size: 0.9em;color:#807696"></i> Related Books : </h3>
    </div>
    {% if book.category.category.all.count <= 1 %}
    <p class="w-100 text-center text-danger d-flex justify-content-center align-items-center" style="font-size: 1.3em;min-height: 30vh;">No related books founded :)</p>
    {% else %}
    <div class="related-books d-flex align-item-center mb-5 gap-3 flex-wrap">
        {% for i in book.category.category.all %}
        {% if i.id != book.id %}
        <div class="card" style="width: 18rem;">
            <img src="{{i.image_url}}" class="card-img-top" alt="book-image">
            <div class="card-body">
                <h5 class="card-title">{{i.title}}</h5>
                <p class="card-text">{{i.description}}</p>
                <a href="{% url 'books.book' i.id %}" class="btn btn-primary">Show</a>
            </div>
        </div>
        {% endif %}
        {% endfor %}
    </div>
    {% endif %}
</div>

<script>
    if(document.getElementById('return-btn')){
        let returnBtn = document.getElementById('return-btn');

        returnBtn.addEventListener('click', (e)=>{
            Swal.fire({
                title: "Are you sure?",
                text: "You want to return this book!",
                icon: "warning",
                showCancelButton: true,
                confirmButtonColor: "#3085d6",
                cancelButtonColor: "#d33",
                confirmButtonText: "Yes, return it!"
            }).then((result) => {
            if (result.isConfirmed) {
                book_id = e.target.getAttribute("data-book");
                window.location.replace(`/books/${book_id}/return`)
            }
            });
        });
    }

    if(document.getElementById('borrow-btn')){
        let borrowBtn = document.getElementById('borrow-btn');

        borrowBtn.addEventListener('click', (e)=>{
            Swal.fire({
                title: "Are you sure?",
                text: "You want to borrow this book!",
                icon: "warning",
                showCancelButton: true,
                confirmButtonColor: "#3085d6",
                cancelButtonColor: "#d33",
                confirmButtonText: "Yes, borrow it!"
            }).then((result) => {
            if (result.isConfirmed) {
                book_id = e.target.getAttribute("data-book");
                window.location.replace(`/books/${book_id}/borrow`)
            }
            });
        });
    }
    
</script>
{% endblock content %}